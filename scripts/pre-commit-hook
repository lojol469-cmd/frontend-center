#!/bin/bash

# ===========================================
# üîç Pre-commit Hook - Mobile Connection Check
# V√©rifie automatiquement les probl√®mes de connexion mobile
# avant chaque commit
# ===========================================

echo "üîç Pre-commit Hook: V√©rification connexion mobile..."

# V√©rifier si les fichiers critiques ont √©t√© modifi√©s
CHANGED_FILES=$(git diff --cached --name-only)

if echo "$CHANGED_FILES" | grep -qE "(server_config\.dart|api_service\.dart)"; then
    echo "üìù Fichiers de configuration modifi√©s, v√©rification automatique..."

    # V√©rifier si Dart est disponible
    if command -v dart &> /dev/null; then
        # Ex√©cuter le diagnostic automatique
        dart run scripts/mobile_connection_fix.dart

        if [ $? -ne 0 ]; then
            echo "‚ùå PROBL√àME D√âTECT√â: Les corrections automatiques ont √©chou√©"
            echo "üîß Veuillez corriger manuellement ou utiliser fix_mobile_connection.bat"
            echo ""
            echo "Pour ignorer ce hook (d√©conseill√©):"
            echo "git commit --no-verify -m \"votre message\""
            exit 1
        fi

        echo "‚úÖ Configuration valid√©e - Commit autoris√©"
    else
        echo "‚ö†Ô∏è Dart non trouv√© - V√©rification manuelle recommand√©e"
        echo "üìñ Consultez MOBILE_CONNECTION_FIX.md pour les d√©tails"
    fi
else
    echo "‚úÖ Aucun fichier critique modifi√© - Commit autoris√©"
fi

echo ""